{% extends 'index.html' %}

{% block title %}
    Rezervace | {{project_name}}
{% endblock title  %}

{% block content %}
    <p class="paragraph_1">
        Vítám Vás na naší stránce rezervace termínu pro naše relaxační masáže. Zarezervovat si svůj čas na chvíli odpočinku je snadné a rychlé. Stačí následovat několik jednoduchých kroků:
    </p>

    <ol>
        <li>
            <strong>Vyberte Typ Masáže:</strong> Nejprve si vyberte typ masáže, který byste chtěli zažít. Nabízím širokou škálu masáží, které Vám pomohou relaxovat a odstranit stres.
        </li>
        <li>
            <strong>Vyberte Datum a Čas:</strong> Zvolte si datum a čas, který Vám nejlépe vyhovuje. Jsem tu pro Vás, abych se postarala o Vaše pohodlí.
        </li>
        <li>
            <strong>Vyplňte Kontaktní Informace:</strong> Prosím, vyplňte krátký formulář s Vašimi kontaktními údaji, abych Vás mohla kontaktovat ohledně Vaší rezervace.
        </li>
        <li>
            <strong>Potvrďte Rezervaci:</strong> Klikněte na tlačítko "Potvrdit rezervaci" a Vaše žádost o rezervaci bude odeslána na zpracování.
        </li>
        <li>
            <strong>Potvrzení na Email:</strong> Po zpracování Vaší rezervace Vám zašleme potvrzovací email s detaily Vašeho termínu masáže. Ujistěte se, že Váš email je správně zadaný.
        </li>
    </ol>

    <p class="paragraph_1">
        Pokud byste raději komunikovali se mnou přímo nebo měli nějaké speciální požadavky, neváhejte mě kontaktovat. Klikněte na sekci "Kontakt" na mé stránce, kde najdete moje telefonní číslo a emailovou adresu. Jsem tu pro vás a ráda Vám poskytnu veškeré informace, které potřebujete.
    </p>

    <p>
        Děkuji za Váš zájem o mé masáže a těším se na to, že Vás brzy uvidím!
    </p>

     <div class="reservation_box">
        <div class="reservation_title">
            Rezervace
        </div>
        <form action="{{url_for('rezervace_create')}}" method="post">
            <label class="reservation_label" for="reservation_name">Jméno</label>
            <input style="max-width: 75px; width: 75px;" id="reservation_name" name="reservation_name" type="text" class="reservation_input_text" placeholder="Jméno">
            <label class="reservation_label" for="reservation_surname">Přijmení</label>
            <input style="max-width: 75px; width: 75px;" id="reservation_surname" name="reservation_surname" type="text" class="reservation_input_text" placeholder="Přijmení">
            <br>
            <label class="reservation_label" for="reservation_year">Rok narození</label>
            <input style="width: 60px;" id="reservation_year" name="reservation_year" type="number" min="1900" max="2100" class="reservation_input_text" placeholder="2000" value="2000">
            <br>
            <label class="reservation_label" for="reservation_email">E-mail</label>
            <input style="max-width: 200px; width: 200px;" id="reservation_email" name="reservation_email" type="text" class="reservation_input_text" placeholder="ukazkovy@email.cz">
            <br>
            <label class="reservation_label" for="reservation_phone">Telefonní číslo</label>
            <input style="max-width: 100px; width: 100px;" id="reservation_phone" name="reservation_phone" type="text" class="reservation_input_text" placeholder="000 000 000">
            <br>
            <br>

            <p>
                Termíny během týdne se liší podle dne, ale o víkendech jsem flexibilní a časy se mohou měnit podle potřeb. Víkendy jsou více volné a spontánní, což mi umožňuje Vám lépe vyhovět.
            </p>

            <label class="reservation_label" for="reservation_date">Datum</label>
            <input onchange="onDateChange()" style="width: fit-content;" id="reservation_date" name="reservation_date" type="date" class="reservation_input_text" placeholder="">


            <label for="reservation_time" class="reservation_label">Čas</label>

            <select onchange="isReservationAvailable()" id="reservation_time" class="reservation_select" name="reservation_time" size="1">  
            </select>  

            <br>
            <p class="reservation_available" id="available"></p>

            <br>
            <br>

            <label class="reservation_label" for="reservation_type">Typ masáže</label>

            <br>
            <select style="margin-top: 3px; width: 75%;" class="reservation_select" name="reservation_type" size="1">  
                <option value="typ1"> Typ1 </option> 
                <option value="typ2"> Typ2 </option> 
                <option value="typ3"> Typ3 </option> 
            </select>  

            <br>
            <br>

            <label class="reservation_label" for="reservation_notes">Prostor pro Vaše poznámky</label>
            <br>
            <textarea name="reservation_notes" class="reservation_notes"></textarea>

            <br>
            <input type="submit" class="reservation_submit_button" value="Potvrdit">
        </form>
     </div>
{% endblock content %}

{% block script %}
    <script>
        const reservationDateElmnt = document.getElementById("reservation_date");
        const reservationTimeSelElmnt = document.getElementById("reservation_time");
        const reservationAvailableElmnt = document.getElementById("available");

        const urlCheckIfReservationAvailable = "{{ url_for('is_reservation_available') }}"

        function isWeekend(date = new Date()) {
        return date.getDay() === 6 || date.getDay() === 0;
        }

        function isReservationAvailable()
        {
            var date = reservationDateElmnt.value;
            var time = reservationTimeSelElmnt.value;

            if (date == "" || time == "")
            {
                console.log("Date or time not selected");
                return;
            }
            else
            {
                var url = urlCheckIfReservationAvailable + "/" + date + "/" + time;

                $.ajax({
                    url: url,
                    success: function(data) {
                        if (data == "y")
                        {
                            reservationAvailableElmnt.innerText = "Termín je dostupný.";
                        }
                        else if (data == "n")
                        {
                            reservationAvailableElmnt.innerText = "Termín není dostupný!";
                        }
                    },
                    error: function(jqXHR,error, errorThrown) {  
                        // TODO IF ERROR
                    },
                });
            }
        }

        function onDateChange()
        {
            var date = new Date(reservationDateElmnt.value);
            var dayNumber = date.getDay();

           // Weekend
           if (isWeekend(date))
           {
                reservationTimeSelElmnt.innerHTML = '';
                reservationTimeSelElmnt.innerHTML += '<option value="9:00">9:00</option>';
                reservationTimeSelElmnt.innerHTML += '<option value="11:30">11:30</option>';
                reservationTimeSelElmnt.innerHTML += '<option value="14:00">14:00</option>';
                reservationTimeSelElmnt.innerHTML += '<option value="16:30">16:30</option>';
                reservationTimeSelElmnt.innerHTML += '<option value="19:00">19:00</option>';
           }
           // Monday, Tuesday, Friday
           else if (dayNumber == 1 || dayNumber == 2 || dayNumber == 5)
           {
                reservationTimeSelElmnt.innerHTML = '';
                reservationTimeSelElmnt.innerHTML += '<option value="16:00">16:00</option>';
                reservationTimeSelElmnt.innerHTML += '<option value="18:00">18:00</option>';
           }
           // Wednesday
           else if (dayNumber == 3)
           {
                reservationTimeSelElmnt.innerHTML = '';
                reservationTimeSelElmnt.innerHTML += '<option value="16:00">16:00</option>';
           }
           // Thursday
           else if (dayNumber == 4)
           {
                reservationTimeSelElmnt.innerHTML = '';
                reservationTimeSelElmnt.innerHTML += '<option value="18:00">18:00</option>';
           }

           isReservationAvailable()
        }
    </script>
{% endblock script %}